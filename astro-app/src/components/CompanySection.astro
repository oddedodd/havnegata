---
import { urlFor } from "../utils/image";
import PortableTextRenderer from "./PortableTextRenderer";
import OfferSlider from "./OfferSlider";
import { getTilbudByCompany } from "../utils/sanity";
import DisplayLinks from "./DisplayLinks.astro";
import OpenInNewTabButton from "./OpenInNewTabButton.astro";

interface Props {
  name: string;
  slug: string;
  tagline?: string;
  bgImage?: any;
  bgColor?: { hex: string };
  textColor?: { hex: string };
  shadowColor?: { hex: string };
  body?: any;
  links?: any;
  showOpenInNewTab?: boolean;
}

const { 
  name, 
  slug, 
  tagline = '', 
  bgImage, 
  bgColor, 
  textColor, 
  shadowColor, 
  body, 
  links,
  showOpenInNewTab = false 
}: Props = Astro.props;

const tilbud = await getTilbudByCompany(slug);
const bgImageUrl = bgImage ? urlFor(bgImage).width(1200).height(600).url() : null;
const bgColorHex = bgColor?.hex || '#f9e6ef';
const shadowColorHex = shadowColor?.hex || '#d48fcf';
---

<!-- Hero Section -->
<div 
  id={slug}
  class="relative h-screen w-full h-96 flex items-center justify-center overflow-hidden rounded-lg" 
  style={`background: ${bgImageUrl ? `url('${bgImageUrl}') center/cover no-repeat` : bgColorHex};`}
>
  <!-- Overlay for pastel effect -->
  <div 
    class="absolute inset-0 opacity-60" 
    style={`background-color: ${bgColorHex};`}
  ></div>
  
  <!-- Content -->
  <div class="relative z-20 flex flex-col items-center justify-center w-full">
    <span class="text-white text-xl sm:text-2xl font-body font-light mb-2 tracking-wide">
      {name}
    </span>
    {tagline && (
      <h1 
        class="text-white text-5xl sm:text-6xl font-headline font-extrabold mb-2 px-4" 
        style={`text-shadow: 2px 3px 0 ${shadowColorHex};`}
      >
        {tagline}
      </h1>
    )}
  </div>
</div>

<!-- Content Section -->
<div class="min-h-screen w-full" style={`background-color: ${bgColorHex};`}>
  {body && (
    <div class="container mx-auto px-4 py-8 max-w-3xl">
      <PortableTextRenderer value={body} client:load />
    </div>
  )}
  <DisplayLinks links={links} />
  
  {showOpenInNewTab && <OpenInNewTabButton slug={slug} />}
</div>

<OfferSlider tilbud={tilbud} textColor={textColor} companyName={name} client:load />
